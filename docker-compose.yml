services:
  botmaker:
    build: .
    container_name: botmaker
    ports:
      - "7100:7100"
    volumes:
      # Docker socket for container management
      - /var/run/docker.sock:/var/run/docker.sock
      # Persistent data
      - botmaker-data:/app/data
      - botmaker-secrets:/app/secrets
    environment:
      - PORT=7100
      - DATA_DIR=/app/data
      - SECRETS_DIR=/app/secrets
      # Volume names for runtime path discovery
      - DATA_VOLUME_NAME=botmaker_botmaker-data
      - SECRETS_VOLUME_NAME=botmaker_botmaker-secrets
      - OPENCLAW_IMAGE=openclaw:latest
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "node", "-e", "fetch('http://localhost:7100/health').then(r=>process.exit(r.ok?0:1)).catch(()=>process.exit(1))"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

volumes:
  botmaker-data:
  botmaker-secrets:
