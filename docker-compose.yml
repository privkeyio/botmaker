version: '3.8'

services:
  botmaker:
    build: .
    container_name: botmaker
    ports:
      - "7100:7100"
    volumes:
      # Docker socket for container management
      - /var/run/docker.sock:/var/run/docker.sock
      # Persistent data
      - botmaker-data:/app/data
      - botmaker-secrets:/app/secrets
    environment:
      - PORT=7100
      - DATA_DIR=/app/data
      - SECRETS_DIR=/app/secrets
      # Host paths for Docker bind mounts (bot containers created from BotMaker)
      - HOST_DATA_DIR=/var/lib/docker/volumes/botmaker_botmaker-data/_data
      - HOST_SECRETS_DIR=/var/lib/docker/volumes/botmaker_botmaker-secrets/_data
      - OPENCLAW_IMAGE=openclaw:latest
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:7100/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

volumes:
  botmaker-data:
  botmaker-secrets:
